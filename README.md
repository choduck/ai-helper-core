# AI 헬퍼 코어 (ai-helper-core)

**GPT for Team을 위한 Python 기반 AI 백엔드 서버**

## 1. 프로젝트 개요

AI 헬퍼 코어는 B2B용 OpenAI API 기반 GPT 계정관리 시스템의 핵심 AI 기능을 담당하는 Python 기반 백엔드 서버입니다. 이 컴포넌트는 FastAPI를 활용하여 OpenAI API 연동, 음성 처리, 벡터 검색 등 AI 관련 기능을 제공합니다.

전체 시스템은 다음 3개의 주요 컴포넌트로 구성됩니다:

```
ai-helper/
├── ai-helper-front (프론트엔드 - React/Next.js)
├── ai-helper-back (메인 백엔드 - Java/Spring Boot)
└── ai-helper-core (AI 엔진 백엔드 - Python/FastAPI)
```

## 목차
1. [프로젝트 개요](#1-프로젝트-개요)
2. [기술 스택](#2-기술-스택)
3. [시스템 아키텍처](#3-시스템-아키텍처)
4. [API 엔드포인트 설계](#4-api-엔드포인트-설계)
5. [Chroma DB 벡터 스토어 설계](#5-chroma-db-벡터-스토어-설계)
6. [구현 로드맵](#6-구현-로드맵)
7. [기술적 고려사항](#7-기술적-고려사항)
8. [시작하기](#8-시작하기)
9. [사용자별 토큰 사용량 모니터링 및 제한 기능](#9-사용자별-토큰-사용량-모니터링-및-제한-기능)
10. [향후 확장 계획](#10-향후-확장-계획)
11. [기여하기](#11-기여하기)
12. [라이센스](#12-라이센스)

## 2. 기술 스택

### 핵심 기술
- **언어**: Python 3.10+
- **웹 프레임워크**: FastAPI
- **비동기 처리**: asyncio, uvicorn
- **컨테이너화**: Docker
- **API 문서화**: Swagger/OpenAPI
- **테스트**: pytest

### 데이터베이스
- **메인 DB 연결**: SQLAlchemy (ai-helper-back과 동일 DB 접근)
- **벡터 데이터베이스**: Chroma DB (임베딩 저장 및 검색용)

### 외부 API 통합
- **LLM API**: OpenAI API (GPT-4, GPT-3.5)
- **임베딩**: OpenAI Ada 002 임베딩 모델
- **음성 처리**: Whisper API (STT), ElevenLabs API (TTS)

## 3. 시스템 아키텍처

### 컴포넌트 구조
![시스템 아키텍처](https://via.placeholder.com/800x500?text=AI+Helper+Core+Architecture)

### 주요 모듈

#### LLM 프록시 모듈
- OpenAI API 호출 추상화 및 최적화
- 토큰 사용량 모니터링 및 제한 기능
- 오류 처리 및 재시도 로직

#### Chroma DB 기반 RAG 모듈
- 문서 처리 및 청크 분할 (Chunking)
- OpenAI 임베딩 생성 및 Chroma DB 저장
- 시맨틱 검색 및 관련 문서 검색
- LLM 응답 생성을 위한 컨텍스트 주입

#### 음성 처리 모듈
- 음성-텍스트 변환 (STT)
- 텍스트-음성 변환 (TTS)
- 실시간 스트리밍 지원

#### 프롬프트 관리 모듈
- 템플릿 기반 프롬프트 관리
- 조직별 커스텀 프롬프트 저장
- 프롬프트 변수 처리

#### 캐싱 및 최적화 모듈
- 반복 쿼리 캐싱
- 비용 최적화 알고리즘
- 배치 처리 지원

## 4. API 엔드포인트 설계

### 채팅/대화 API
```
POST /api/chat/completions - 텍스트 대화 생성
POST /api/chat/stream - 스트리밍 대화 생성
GET /api/models - 사용 가능 모델 목록
```

### 벡터 검색 및 RAG API
```
POST /api/knowledge/documents - 문서 업로드
GET /api/knowledge/documents - 문서 목록 조회
POST /api/knowledge/search - 벡터 검색
POST /api/knowledge/query - RAG 기반 질의응답
```

### 음성 API
```
POST /api/speech/transcribe - 음성-텍스트 변환
POST /api/speech/synthesize - 텍스트-음성 변환
```

### 관리 API
```
GET /api/usage - 사용량 통계
POST /api/prompt-templates - 프롬프트 템플릿 생성
GET /api/prompt-templates - 프롬프트 템플릿 조회
```

## 5. Chroma DB 벡터 스토어 설계

AI 헬퍼 코어는 RAG(Retrieval-Augmented Generation) 기능을 위해 Chroma DB를 벡터 데이터베이스로 활용합니다.

### Chroma DB 선택 이유
- **오픈소스**: 자체 호스팅 가능한 오픈소스 벡터 DB
- **Python 네이티브**: Python 생태계와 완벽하게 통합
- **빠른 쿼리 속도**: 효율적인 벡터 검색 알고리즘
- **메타데이터 필터링**: 다양한 필터링 옵션 제공
- **확장성**: 대규모 데이터셋 처리 가능

### Chroma DB 구현 계획
- 조직별 별도 컬렉션 생성
- 문서 메타데이터 구조화 (파일타입, 날짜, 카테고리 등)
- 청크 사이즈 최적화 (기본 1000자)
- 주기적 임베딩 업데이트 메커니즘

### 인덱싱 및 검색 최적화
- 문서 전처리 파이프라인 구축
- 다양한 거리 측정 방법 지원 (코사인 유사도 기본)
- Top-k 검색 결과 최적화
- 메타데이터 기반 필터링 구현

## 6. 구현 로드맵

### 1단계: 기본 인프라 구축 (2주)
- [x] 프로젝트 기본 구조 설정
- [ ] FastAPI 프레임워크 설정
- [ ] Docker 컨테이너화
- [ ] CI/CD 파이프라인 구축
- [ ] 기본 API 엔드포인트 구현

### 2단계: LLM 프록시 구현 (2주)
- [ ] OpenAI API 클라이언트 구현
- [ ] 모델 파라미터 관리 시스템
- [ ] 토큰 사용량 모니터링
- [ ] 오류 처리 및 재시도 로직
- [ ] 응답 캐싱 구현

### 3단계: Chroma DB & RAG 통합 (3주)
- [ ] Chroma DB 설정 및 연결
- [ ] 문서 처리 및 청킹 파이프라인
- [ ] 임베딩 생성 및 저장 로직
- [ ] 벡터 검색 API 구현
- [ ] RAG 프롬프트 최적화
- [ ] 문서 관리 인터페이스

### 4단계: 음성 처리 구현 (2주)
- [ ] Whisper API 통합 (STT)
- [ ] ElevenLabs API 통합 (TTS)
- [ ] 음성 파일 처리 유틸리티
- [ ] 실시간 음성 스트리밍
- [ ] 다국어 음성 처리 지원

### 5단계: 프롬프트 관리 시스템 (2주)
- [ ] 프롬프트 템플릿 저장소
- [ ] 변수 치환 기능
- [ ] 템플릿 버전 관리
- [ ] 조직별 템플릿 격리
- [ ] 템플릿 평가 및 최적화

### 6단계: 통합 및 최적화 (3주)
- [ ] ai-helper-back과 통합
- [ ] 인증 및 권한 시스템 연동
- [ ] 성능 최적화 및 벤치마킹
- [ ] 부하 테스트 및 스케일링
- [ ] 로깅 및 모니터링 강화

### 7단계: 테스트 및 배포 (2주)
- [ ] 단위 테스트 구현
- [ ] 통합 테스트 구현
- [ ] 문서화 완료
- [ ] 보안 감사
- [ ] 프로덕션 배포

## 7. 기술적 고려사항

### 성능 최적화
- **비동기 처리**: FastAPI의 비동기 기능을 활용한 동시성 최적화
- **배치 처리**: 대량 요청의 배치 처리로 API 호출 최소화
- **캐싱 전략**: 다단계 캐싱으로 응답 속도 향상 및 비용 절감

### 확장성
- **수평적 확장**: 여러 인스턴스로 부하 분산 지원
- **모듈 분리**: 마이크로서비스 아키텍처 지향
- **API 버전 관리**: 하위 호환성 유지

### 보안
- **인증 통합**: ai-helper-back의 JWT 인증 활용
- **API 키 관리**: 안전한 API 키 저장 및 순환
- **데이터 암호화**: 민감 정보 암호화 저장

## 8. 시작하기

### 필수 요구사항
- Python 3.10 이상
- Docker 및 Docker Compose
- OpenAI API 키

### 설치 방법
```bash
# 저장소 복제
git clone https://github.com/your-org/ai-helper.git
cd ai-helper/ai-helper-core

# 가상환경 생성
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 의존성 설치
pip install -r requirements.txt

# 환경 변수 설정
cp .env.example .env
# .env 파일에 필요한 API 키 등을 설정

# 개발 서버 실행
uvicorn app.main:app --reload
```

### Docker로 실행
```bash
docker-compose up -d
```

## 9. 사용자별 토큰 사용량 모니터링 및 제한 기능

### 개요
AI 헬퍼 시스템은 OpenAI API를 활용하여 사용자에게 서비스를 제공합니다. 이 기능은 관리자가 각 사용자의 API 토큰 사용량을 모니터링하고 제한할 수 있도록 하여 비용 관리 및 리소스 할당을 최적화합니다.

### 주요 기능

#### 1. 토큰 사용량 대시보드
- **메뉴명**: "토큰 사용량 관리"
- **위치**: 관리자 패널 메인 메뉴
- **기능**:
  - 전체 시스템의 누적 토큰 사용량 요약 통계 (일간/주간/월간)
  - 사용자별 토큰 사용량 순위 (상위 10명)
  - 모델별 사용량 분포 (차트 형식)
  - 비용 추정 (토큰 사용량 × 모델별 비용)

#### 2. 사용자별 토큰 사용량 조회
- **메뉴명**: "사용자별 사용량"
- **기능**:
  - 사용자 목록에 토큰 사용량 열 추가 (입력/출력 토큰 구분)
  - 사용자별 상세 사용량 보기 (기간별 필터링)
  - 사용 패턴 시각화 (일/주/월별 그래프)
  - 대화별 토큰 사용량 세부정보

#### 3. 토큰 제한 설정
- **메뉴명**: "토큰 제한 설정"
- **기능**:
  - 사용자별 월간 최대 토큰 사용량 설정
  - 조직별 토큰 풀(Pool) 설정
  - 사용량 임계값 알림 설정 (80%, 90%, 100%)
  - 제한 초과 시 정책 설정 (차단, 경고, 관리자 승인)

#### 4. 알림 및 리포트
- **메뉴명**: "사용량 알림 설정"
- **기능**:
  - 주간/월간 사용량 리포트 생성
  - 임계값 도달 시 이메일 알림
  - 비정상적 사용패턴 감지 및 알림
  - 사용량 예측 리포트

### 기술적 구현 방안

#### 데이터베이스 변경
- `usage_statistics` 테이블 활용 (이미 존재함)
- `user_token_limits` 테이블 신규 생성 (사용자별 제한 관리)
- `token_usage_alerts` 테이블 신규 생성 (알림 관리)

#### 백엔드 API 확장
```
/api/admin/usage/statistics - 전체 사용량 통계
/api/admin/usage/users - 사용자별 사용량
/api/admin/usage/users/{id} - 특정 사용자 사용량
/api/admin/usage/limits - 제한 설정 관리
/api/admin/usage/alerts - 알림 설정 관리
/api/admin/usage/reports - 리포트 생성
```

#### 프론트엔드 구현
- 관리자 대시보드에 토큰 사용량 요약 위젯 추가
- 토큰 사용량 대시보드 페이지 신규 생성
- 사용자 관리 페이지에 토큰 제한 설정 기능 통합
- 데이터 시각화를 위한 차트 라이브러리 활용 (Chart.js, D3.js 등)

#### UI 디자인 방향
- 직관적인 대시보드 레이아웃
- 토큰 사용량을 시각적으로 표현하는 차트와 그래프
- 색상 코드로 제한 임계값 표시 (녹색-안전, 노란색-주의, 빨간색-위험)
- 반응형 디자인으로 모바일 접근성 보장

#### 개발 로드맵
1. 데이터베이스 스키마 확장 (1주)
2. 백엔드 API 개발 (2주)
3. 프론트엔드 UI 구현 (2주)
4. 통합 테스트 및 디버깅 (1주)
5. 사용자 테스트 및 피드백 수집 (1주)
6. 최종 릴리스 및 모니터링 (1주)

### 기대효과
- API 사용 비용의 효율적 관리 및 최적화
- 리소스 할당의 공정성 확보
- 비정상적 사용 패턴 조기 감지
- 데이터 기반 의사결정 지원

### 향후 확장 가능성
- 비용 예측 및 예산 계획 기능
- 자동 최적화 알고리즘 (사용자별 모델 추천)
- 사용량 기반 요금제 모델 구현
- BI 도구 연동을 통한 고급 분석

## 10. 향후 확장 계획

### 추가 예정 기능
- **이미지 생성 및 분석**: DALL-E 및 Vision API 통합
- **파인튜닝 관리**: 조직별 파인튜닝 모델 관리
- **멀티모달 처리**: 이미지, 음성, 텍스트 통합 처리
- **에이전트 프레임워크**: 도구 사용이 가능한 GPT 에이전트

### 통합 가능 서비스
- **Google Workspace/Microsoft 365**: 문서 통합
- **Slack/Teams**: 메시징 플랫폼 연동
- **Jira/Trello**: 작업 관리 도구 연동

## 11. 기여하기

프로젝트에 기여하는 방법에 대한 자세한 내용은 [CONTRIBUTING.md](CONTRIBUTING.md)를 참조하세요.

## 12. 라이센스

이 프로젝트는 [MIT 라이센스](LICENSE)에 따라 라이센스가 부여됩니다. 